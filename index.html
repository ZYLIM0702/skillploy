<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Information</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { db, auth } from '../firebase-config.js';

        document.addEventListener('DOMContentLoaded', () => {
            const userInfo = document.getElementById('user-info');
            const logoutButton = document.getElementById('logout-btn');

            const getUserData = async (uid) => {
                const collections = ['Students', 'Employers', 'Lecturers'];
                
                for (const collectionName of collections) {
                    const userDocRef = doc(db, collectionName, uid);
                    const userDoc = await getDoc(userDocRef);
                    
                    if (userDoc.exists()) {
                        return { data: userDoc.data(), collection: collectionName };
                    }
                }
                return null;
            };

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const uid = user.uid;
                    const userResult = await getUserData(uid);
                    
                    if (userResult) {
                        const { data, collection } = userResult;
                        userInfo.innerHTML = `
                            <h2>Welcome, ${data.name || 'User'}!</h2>
                            <p>Email: ${data.email || 'N/A'}</p>
                            <p>Account Type: ${collection}</p>
                            ${data.institution ? `<p>Institution: ${data.institution}</p>` : ''}
                            ${data.faculty ? `<p>Faculty: ${data.faculty}</p>` : ''}
                            ${data.companyName ? `<p>Company Name: ${data.companyName}</p>` : ''}
                        `;
                    } else {
                        userInfo.innerHTML = '<p>Account data not found.</p>';
                    }
                    logoutButton.style.display = 'block';
                } else {
                    userInfo.innerHTML = '<p>You are not logged in. <a href="signup.html">Sign up here</a>.</p>';
                    logoutButton.style.display = 'none';
                }
            });

            logoutButton.addEventListener('click', () => {
                signOut(auth).then(() => {
                    localStorage.removeItem('user');
                    window.location.href = 'signup.html';
                }).catch((error) => {
                    alert('Error logging out: ' + error.message);
                });
            });
        });
    </script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Account Information</h1>
        <div id="user-info" class="text-center mt-4"></div>
        <div class="text-center mt-3">
            <button id="logout-btn" class="btn btn-danger" style="display:none;">Logout</button>
        </div>
    </div>
</body>
</html>
